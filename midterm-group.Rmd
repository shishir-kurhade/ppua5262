---
title: "midterm-group"
author: "Shishir Kurhade"
date: "06/10/2019"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(magrittr)
library(leaflet)
library(tidycensus)
library(tigris)
library(sf)
library(acs)
census_api_key("3c3629c35ba44bcbea7c5636cb93deefd7b0db39")

```

## R Markdown

Please upload an updated version of your data set to the Boston Data Library by the end of the week. Technical instructions for using the Dataverse are attached.

Make sure your group includes:
The record-level file with all new and modified variables included.
An updated Data Documentation that describes the new variables and, if necessary, modifies the description of any already existing variables.
Annotated R syntax clearly articulating steps for all data cleaning and variable creation. This should be efficient and complete such that the code could be run all at once on raw data to recreate the updated data set.
Link to Boston Data Library: https://dataverse.harvard.edu/dataverse/BARI



```{r, echo=FALSE}




#str_replace(data$street,'[0-9]+','')
```
```{r}
data<-read.csv('C:\\Users\\HP\\Desktop\\PPUA 5262 Big Data for Cities\\Data Assignments\\Assignment 1\\places.csv')


(nrow(data))
(ncol(data))

#
data <-separate(data,Blk_ID_10,c('State','Extra'),sep=2,remove= FALSE)
data <-separate(data,Extra,c('County','Extra'),sep=3,remove=TRUE)
data <-separate(data,Extra,c('Tract_Group','Block_Group'),sep=6,remove=TRUE)
data <-separate(data,vicinity,c('street','city'),sep=",",remove=FALSE)
data$street <-gsub('[0-9]+', "", data$street)


data['category_group'] <- ifelse(c(data$Tag_1=='restaurant'|data$Tag_1=='meal_delivery'|data$Tag_1=='meal_takeaway'|data$Tag_1=='bakery'|data$Tag_1=='cafe'|data$Tag_1=='bar'|data$Tag_1=='convenience_store'|data$Tag_1=='liquor_store'|data$Tag_1=='supermarket'|data$Tag_1=='food'),'food_drink',
       ifelse(c(data$Tag_1=='art_gallery'|data$Tag_1=='aquarium'|data$Tag_1=='amusement_park'|data$Tag_1=='bowling_alley'|data$Tag_1=='casino'|data$Tag_1=='movie_rental'|data$Tag_1=='movie_theater'|data$Tag_1=='museum'|data$Tag_1=='night_club'|data$Tag_1=='shopping_mall'|data$Tag_1=='tourist_attraction'|data$Tag_1=='zoo'|data$Tag_1=='stadium'),'entertainment',
              ifelse(c(data$Tag_1=='airport'|data$Tag_1=='city_hall'|data$Tag_1=='courthouse'|data$Tag_1=='fire_station'|data$Tag_1=='library'|data$Tag_1=='local_government_office'|data$Tag_1=='post_office'|data$Tag_1=='police'|data$Tag_1=='park'),'municipal',
                     ifelse(c(data$Tag_1=='accounting'|data$Tag_1=='beauty_salon'|data$Tag_1=='bicycle_store'|data$Tag_1=='car_rental'|data$Tag_1=='car_dealer'|data$Tag_1=='car_repair'|data$Tag_1=='book_store'|data$Tag_1=='car_wash'|data$Tag_1=='clothing_store'|data$Tag_1=='department_store'|data$Tag_1=='drugstore'|data$Tag_1=='electronics_store'|data$Tag_1=='florist'|data$Tag_1=='funeral_home'|data$Tag_1=='furniture_store'|data$Tag_1=='hair_care'|data$Tag_1=='jewelry_store'|data$Tag_1=='home_goods_store'|data$Tag_1=='insurance_agency'|data$Tag_1=='laundry'|data$Tag_1=='hardware_store'|data$Tag_1=='locksmith'|data$Tag_1=='pet_store'|data$Tag_1=='painter'|data$Tag_1=='moving_company'|data$Tag_1=='pharmacy'|data$Tag_1=='plumber'|data$Tag_1=='shoe_store'|data$Tag_1=='store'|data$Tag_1=='travel_agency'|data$Tag_1=='spa'|data$Tag_1=='roofing_contractor'|data$Tag_1=='real_estate_agency'|data$Tag_1=='bank'|data$Tag_1=='gas_station'|data$Tag_1=='atm'|data$Tag_1=='storage'|data$Tag_1=='finance'|data$Tag_1=='general_contractor'|data$Tag_1=='electrician'|data$Tag_1=='lawyer'),'goods_services',
                            ifelse(c(data$Tag_1=='church'|data$Tag_1=='hindu_temple'|data$Tag_1=='mosque'|data$Tag_1=='synagogue'),'place_of_worship',
                                   ifelse(c(data$Tag_1=='dentist'|data$Tag_1=='doctor'|data$Tag_1=='physiotherapist'|data$Tag_1=='veterinary_care'|data$Tag_1=='gym'|data$Tag_1=='hospital'),'health',
                                          ifelse(c(data$Tag_1=='campground'|data$Tag_1=='lodging'|data$Tag_1=='rv_park'),'lodging',
                                                 ifelse(c(data$Tag_1=='school'|data$Tag_1=='secondary_school'|data$Tag_1=='primary_school'|data$Tag_1=='university'),'education',
                                                        ifelse(c(data$Tag_1=='cemetery'|data$Tag_1=='embassy'),'other',
                                                               ifelse(c(data$Tag_1=='parking'|data$Tag_1=='taxi_stand'|data$Tag_1=='bus_station'|data$Tag_1=='transit_station'|data$Tag_1=='train_station'|data$Tag_1=='subway_station'),'parking_transportation','no_tag'))))))))))



```

The areas mentioned in the vicinity are broken out into Boston, Greater Boston, Greater MA (Massachusetts), Outside MA, and N/A. The N/A is for those that do not have any information in the vicinity column. Some vicinities included the name of a square which is inside a city so that had to be accounted for as did inputs such as Gilette which is in Foxborough which is in the Greater Boston area. This variable is named bucket_vicinity.
```{r}
data$bucket_vicinity <- ifelse(data$vicinity==' ','N/A','Place Holder')
i=1;

boston <- c('Cambridge', 'Boston', 'Roslindale', 'Hyde Park', 'Roxbury', 'Jamaica Plain', 'Brighton', 'Dorchester', 'Charlestown', 'Chestnut Hill', 'Allston', 'Mattapan', 'Readville', 'Mission Hill', 'Neponset', 'South End')

greater_boston <- c('Quincy', 'Dedham', 'Brookline', 'Somerville', 'Chelsea', 'Braintree', 'Weymouth', 'Newton', 'Scituate', 'Norwood', 'Watertown', 'Milton', 'Winthrop', 'Medford', 'Everett', 'Arlington', 'Nahant', 'Revere', 'Malden', 'Canton', 'Hingham', 'Lynn', 'Needham', 'North Reading', 'Waltham', 'Burlington', 'Lexington', 'Randolph', 'Wakefield', 'Concord', 'Saugus', 'Natick', 'Wellesley', 'Ipswich', 'Medfield', 'Sloughton', 'Salem', 'Worcester', 'Walpole', 'Melrose', 'Swampscott', 'Peabody', 'Haverhill', 'Framingham', 'Quincy', 'Worcester', 'Stoneham', 'Tewksbury', 'Woburn', 'Pembroke', 'Winter Hill', 'Belmont', 'Wollaston', 'Hull', 'Acton', 'Cohasset', 'Wrentham', 'Gillette', 'Accord', 'Norwell', 'Westwood', 'Squantum', 'Danvers', 'Wenham', 'Marblehead', 'Georgetown', 'Rutland', 'Norfolk')

MA_other <- c('Oak Bluffs', 'Plymouth', 'Elmwood', 'Chester', 'Mashpee', 'Kingston', 'Truro', 'Minot')

while(i<=nrow(data)){
  if(data$bucket_vicinity[i] == 'Place Holder')
  {
    
    if(str_detect(data$vicinity[i], paste(boston, collapse = "|")))
    {
      data$bucket_vicinity[i] = 'Boston'
    } else {
      if(str_detect(data$vicinity[i], paste(greater_boston, collapse = "|")))
      {
        data$bucket_vicinity[i] = 'Greater Boston' 
      } else {
        if(str_detect(data$vicinity[i], paste(MA_other, collapse = "|")))
        {
          data$bucket_vicinity[i] = 'Greater MA' 
        } else {
          data$bucket_vicinity[i] = 'Outside MA' 
        }
        
      }
    }
    
  }
  i=i+1
}
```

```{r, include=FALSE}
data$str_merged_tags <- paste(data$Tag_1, data$Tag_2, data$Tag_3, data$Tag_4, data$Tag_5, data$Tag_6, data$Tag_7, data$Tag_8, data$Tag_9, data$Tag_10, sep=" ")
religious <- c('hindu_temple', 'church', 'mosque', 'synagouge')
religous_by_tract <- aggregate(str_detect(str_merged_tags, paste(religious, collapse = "|"))~Tract_Group, data=data, FUN=sum)
entertainment <- c('stadium', 'movie_theater', 'aquarium', 'entertainment', 'bowling_alley', 'shopping_mall')
entertainment_by_tract <- aggregate(str_detect(str_merged_tags, paste(entertainment, collapse = "|"))~Tract_Group, data=data, FUN=sum)
age_restricted <- c('bar', 'nightclub')
age_restr_by_tract <- aggregate(str_detect(str_merged_tags, paste(age_restricted, collapse = "|"))~Tract_Group, data=data, FUN=sum)
outdoor <- c('campground', 'park')
outdoor_by_tract <- aggregate(str_detect(str_merged_tags, paste(outdoor, collapse = "|"))~Tract_Group, data=data, FUN=sum)
educational <- c('museum', 'library', 'art_gallery')
educational_by_tract <- aggregate(str_detect(str_merged_tags, paste(educational, collapse = "|"))~Tract_Group, data=data, FUN=sum)
dining <- c('restaurant', 'cafe')
dining_by_tract <- aggregate(str_detect(str_merged_tags, paste(dining, collapse = "|"))~Tract_Group, data=data, FUN=sum)

on_alc<-aggregate(str_detect(data$str_merged_tags,paste(c('bar','night_club'),collapse='|'))~data$Tract_Group,data=data,sum)
names(on_alc)[1] <- 'Tract_Group'
names(on_alc)[2]<-'count'
off_alc<-aggregate(str_detect(data$str_merged_tags,'liquor_store')~data$Tract_Group,data=data,sum)
names(off_alc)[1] <- 'Tract_Group'
names(off_alc)[2]<-'count'

```



